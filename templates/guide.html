<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guide {{ guide_id }} - Stepwise Video Processing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        .step-card {
            opacity: 0;
            transform: translateY(50px);
        }
        .step-image {
            transition: transform 0.3s ease;
        }
        .step-image:hover {
            transform: scale(1.05);
        }
        #three-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <!-- Three.js Background -->
    <div id="three-container"></div>
    
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-8">
            <div class="px-4 py-5 sm:px-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900" id="guide-title">Video Processing Guide #{{ guide_id }}</h1>
                        <p class="mt-1 text-sm text-gray-500">Step-by-step instructions generated from your video</p>
                    </div>
                    <div class="flex space-x-3">
                        <a href="/" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                            </svg>
                            Back to Home
                        </a>
                        <button id="download-guide" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Download Guide
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="bg-white shadow sm:rounded-lg mb-8">
            <div class="px-4 py-5 sm:p-6">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-gray-700">Progress</span>
                    <span class="text-sm text-gray-500" id="progress-text">0 of {{ steps|length }} steps completed</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="progress-bar" class="bg-indigo-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Steps -->
        <div class="space-y-8" id="steps-container">
            {% for step in steps %}
            <div class="step-card bg-white shadow overflow-hidden sm:rounded-lg" data-step="{{ loop.index }}">
                <div class="px-4 py-5 sm:px-6 border-l-4 border-gray-300" id="step-{{ loop.index }}-header">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-white font-medium step-number">
                                    {{ step.order }}
                                </div>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">{{ step.title }}</h3>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" class="step-checkbox h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" data-step="{{ loop.index }}">
                            <label class="ml-2 text-sm text-gray-600">Mark as complete</label>
                        </div>
                    </div>
                </div>
                <div class="border-t border-gray-200">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-sm font-medium text-gray-900 mb-2">Instructions</h4>
                                <p class="text-gray-700 leading-relaxed">{{ step.description }}</p>
                            </div>
                            <div>
                                <h4 class="text-sm font-medium text-gray-900 mb-2">Visual Reference</h4>
                                <div class="relative overflow-hidden rounded-lg">
                                    <img 
                                        src="{{ step.image_url }}?w=400&q=80" 
                                        srcset="{{ step.image_url }}?w=400&q=80 1x, 
                                                {{ step.image_url }}?w=800&q=80 2x"
                                        alt="Step {{ step.order }} visual reference" 
                                        class="step-image w-full h-48 object-cover cursor-pointer"
                                        loading="lazy"
                                        decoding="async"
                                        onclick="openImageModal('{{ step.image_url }}', '{{ step.title }}')">
                                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-10 transition-all duration-300 flex items-center justify-center">
                                        <svg class="w-8 h-8 text-white opacity-0 hover:opacity-100 transition-opacity duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Completion Message -->
        <div id="completion-message" class="hidden bg-green-50 border border-green-200 rounded-lg p-6 mt-8">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <svg class="h-8 w-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="text-lg font-medium text-green-800">Congratulations!</h3>
                    <p class="text-green-700">You've completed all steps in this guide. Great job!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="image-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 flex items-center justify-center p-4">
        <div class="relative max-w-4xl max-h-full">
            <button onclick="closeImageModal()" class="absolute top-4 right-4 text-white hover:text-gray-300 z-10">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            <img id="modal-image" 
                 src="" 
                 alt="" 
                 class="max-w-full max-h-full object-contain rounded-lg"
                 loading="eager"
                 decoding="sync">
            <div class="absolute bottom-4 left-4 right-4 bg-black bg-opacity-50 text-white p-4 rounded">
                <h3 id="modal-title" class="text-lg font-medium"></h3>
            </div>
        </div>
    </div>

    <script>
        // Three.js Background Animation
        let scene, camera, renderer, particles;
        
        function initThreeJS() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('three-container').appendChild(renderer.domElement);

            // Create particles
            const geometry = new THREE.BufferGeometry();
            const particleCount = 100;
            const positions = new Float32Array(particleCount * 3);
            
            for (let i = 0; i < particleCount * 3; i++) {
                positions[i] = (Math.random() - 0.5) * 20;
            }
            
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            
            const material = new THREE.PointsMaterial({
                color: 0x4F46E5,
                size: 0.02,
                transparent: true,
                opacity: 0.6
            });
            
            particles = new THREE.Points(geometry, material);
            scene.add(particles);
            
            camera.position.z = 5;
            
            animate();
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (particles) {
                particles.rotation.x += 0.001;
                particles.rotation.y += 0.002;
            }
            
            renderer.render(scene, camera);
        }
        
        // Resize handler
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // GSAP Animations
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Three.js
            initThreeJS();
            
            // Animate title
            gsap.from("#guide-title", {
                duration: 1,
                y: -50,
                opacity: 0,
                ease: "power3.out"
            });
            
            // Animate step cards
            gsap.to(".step-card", {
                duration: 0.8,
                y: 0,
                opacity: 1,
                stagger: 0.2,
                ease: "power3.out",
                delay: 0.3
            });
            
            // Progress tracking
            const checkboxes = document.querySelectorAll('.step-checkbox');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const completionMessage = document.getElementById('completion-message');
            const totalSteps = checkboxes.length;
            
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const stepNumber = this.dataset.step;
                    const stepHeader = document.getElementById(`step-${stepNumber}-header`);
                    const stepNumberElement = stepHeader.querySelector('.step-number');
                    
                    if (this.checked) {
                        // Mark as completed
                        stepHeader.classList.remove('border-gray-300');
                        stepHeader.classList.add('border-green-500');
                        stepNumberElement.classList.remove('bg-gray-300');
                        stepNumberElement.classList.add('bg-green-500');
                        
                        // Animate completion
                        gsap.to(stepHeader, {
                            duration: 0.3,
                            scale: 1.02,
                            yoyo: true,
                            repeat: 1,
                            ease: "power2.inOut"
                        });
                    } else {
                        // Mark as incomplete
                        stepHeader.classList.remove('border-green-500');
                        stepHeader.classList.add('border-gray-300');
                        stepNumberElement.classList.remove('bg-green-500');
                        stepNumberElement.classList.add('bg-gray-300');
                    }
                    
                    updateProgress();
                });
            });
            
            function updateProgress() {
                const completedSteps = document.querySelectorAll('.step-checkbox:checked').length;
                const progressPercentage = (completedSteps / totalSteps) * 100;
                
                progressBar.style.width = progressPercentage + '%';
                progressText.textContent = `${completedSteps} of ${totalSteps} steps completed`;
                
                // Show completion message if all steps are done
                if (completedSteps === totalSteps) {
                    completionMessage.classList.remove('hidden');
                    gsap.from(completionMessage, {
                        duration: 0.8,
                        y: 50,
                        opacity: 0,
                        ease: "power3.out"
                    });
                } else {
                    completionMessage.classList.add('hidden');
                }
            }
            
            // Download guide functionality
            document.getElementById('download-guide').addEventListener('click', function() {
                window.print();
            });
        });
        
        // Image modal functions
        function openImageModal(imageSrc, title) {
            document.getElementById('modal-image').src = imageSrc;
            document.getElementById('modal-title').textContent = title;
            document.getElementById('image-modal').classList.remove('hidden');
            
            gsap.from("#image-modal", {
                duration: 0.3,
                opacity: 0,
                scale: 0.8,
                ease: "power3.out"
            });
        }
        
        function closeImageModal() {
            gsap.to("#image-modal", {
                duration: 0.3,
                opacity: 0,
                scale: 0.8,
                ease: "power3.in",
                onComplete: () => {
                    document.getElementById('image-modal').classList.add('hidden');
                }
            });
        }
        
        // Close modal on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeImageModal();
            }
        });
    </script>
</body>
</html>
